<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KAH — Purchases</title>
  <meta name="description" content="Sui purchases — Kaplan Asset Holdings." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0c0e11; --text:#b8dfff; --muted:#8ba0b8; --sui-blue:#00baff;
      --divider:#1d2733; --topbar-bg:#11161b; --topbar-text:#e9f8ff;
      --nav-pill:#141b21; --nav-pill-active:#1f2a33; --glow-strength:.45;
      --banner-bg:linear-gradient(90deg,#001b29 0%,#004a68 50%,#00baff 100%);
      --banner-text:#d7f6ff; --banner-text-hover:#ffffff;
      --table-bg:#0f151b; --thead-bg:#131b23; --row-alt:#0d141a;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:var(--bg); color:var(--text);
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; overflow-x:hidden; position:relative;
    }
    body::before{
      content:""; position:fixed; top:-180px; right:-180px; width:600px; height:600px; pointer-events:none;
      background:
        radial-gradient(40% 40% at 70% 30%, rgba(56,232,255,.22) 0%, rgba(56,232,255,0) 70%),
        radial-gradient(60% 60% at 30% 70%, rgba(0,128,255,.22) 0%, rgba(0,128,255,0) 70%);
      filter:blur(80px) saturate(130%); opacity:.45; z-index:0;
    }

    .container{max-width:1200px;margin:0 auto;padding:48px 24px}
    h1{font-size:1.6rem;font-weight:800;margin-bottom:10px;color:#eaf7ff}
    p.sub{color:var(--muted);margin-bottom:20px}

    .summary-panel{
      margin-bottom:20px;
      padding:14px 16px;
      border-radius:10px;
      border:1px solid var(--divider);
      background:rgba(0,186,255,0.05);
      font-size:0.95rem;
    }
    .summary-panel strong{color:#eaf7ff}
    .summary-panel span{margin-right:18px;display:inline-block;margin-bottom:4px}

    .table-wrap{width:100%;overflow:auto;border:1px solid var(--divider);border-radius:12px;background:var(--table-bg);box-shadow:0 8px 28px rgba(0,0,0,.35);margin-bottom:28px}
    table{width:100%;border-collapse:collapse;font-variant-numeric:tabular-nums}
    thead th{text-align:left;font-size:.85rem;color:#a9c3da;font-weight:700;padding:14px 16px;background:var(--thead-bg);border-bottom:1px solid var(--divider)}
    tbody td{padding:14px 16px;border-bottom:1px solid var(--divider);white-space:nowrap;vertical-align:middle;color:var(--text)}
    tbody tr:nth-child(odd){background:var(--row-alt)}
    tbody tr:last-child td{border-bottom:none}
    .num{color:var(--sui-blue);font-weight:800}
    .summary-row td{background:rgba(0,186,255,0.08);border-top:1px solid var(--divider);border-bottom:2px solid var(--divider);font-weight:800;color:#e8faff;font-size:1.05rem;padding-top:18px;padding-bottom:18px}
    .summary-row .num{color:#50d3ff;font-size:1.1rem;text-shadow:0 0 12px rgba(0,186,255,.3)}

    @media(max-width:720px){
      thead th,tbody td{padding:12px}
      .container{padding:32px 16px}
      .summary-panel span{display:block}
    }
  </style>
</head>
<body>
  <!-- Shared header mount -->
  <div id="site-header"></div>
  <script>
    fetch('header.html').then(r=>r.text()).then(h=>{document.getElementById('site-header').innerHTML=h});
  </script>

  <div class="container">
    <h1>Purchases</h1>
    <p class="sub">SUI purchases and sales, with cumulative holdings and weighted averages.</p>

    <!-- HIGH-LEVEL SUMMARY -->
    <div id="holdings-summary" class="summary-panel"></div>

    <!-- PURCHASES TABLE -->
    <div class="table-wrap">
      <table id="purchases">
        <thead>
          <tr>
            <th>Count</th>
            <th>Reported</th>
            <th>SUI Acquired</th>
            <th>Avg SUI Cost (GBP)</th>
            <th>Acq Cost (£)</th>
            <th>SUI Holdings (at date)</th>
          </tr>
        </thead>
        <tbody><!-- summary + rows injected by JS --></tbody>
      </table>
    </div>

    <!-- SALES TABLE -->
    <div class="table-wrap">
      <table id="sales">
        <thead>
          <tr>
            <th>Count</th>
            <th>Reported</th>
            <th>SUI Sold</th>
            <th>GBP Proceeds (£)</th>
          </tr>
        </thead>
        <tbody><!-- sales rows injected by JS --></tbody>
      </table>
    </div>
  </div>

  <script>
  (function(){

    // PURCHASES: ["YYYY-MM-DD", SUI_AMOUNT, GBP_TOTAL]
    const LOTS = [
      ["2025-11-07", 630.39,  996.49],
      ["2025-11-06", 166.30,  249.12],
      ["2025-11-06", 794.33, 1195.79],
      ["2025-11-03",1222.74, 2040.38],
      ["2025-10-30", 292.38,  498.24],
      ["2025-10-25",   2.60,    4.96],
      ["2025-10-22", 823.85, 1500.05],
      ["2025-10-21",   1.05,    2.03],
      ["2025-10-20",1290.56, 2536.55],
      ["2025-10-16",1914.93, 3881.38],
      ["2025-10-11",  73.27,  140.50],
      ["2025-10-21",310.925,  584.99],
      ["2025-10-09", 221.61,  514.77],
      ["2025-10-08", 253.76,  676.03],
      ["2025-10-07",752.561, 1992.99],
    ];

    // SALES: ["YYYY-MM-DD", SUI_SOLD, GBP_NET_RECEIVED]
    // SUI_SOLD is set so that: sum(LOTS SUI) - SUI_SOLD = 8,674.96 (your Coinpass balance)
    const SALES = [
      ["2025-11-21", 76.296, 79.34],   // derived from 8,751.256 - 8,674.96
    ];

    const nf0 = new Intl.NumberFormat("en-GB",{maximumFractionDigits:0});
    const nf2 = new Intl.NumberFormat("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2});

    // ---------- PURCHASE SUMMARY & TABLE ----------
    const purchasesBody = document.querySelector("#purchases tbody");
    const salesBody     = document.querySelector("#sales tbody");
    const summaryBox    = document.querySelector("#holdings-summary");
    if (!purchasesBody || !salesBody || !summaryBox) return;

    const chronological = LOTS.slice().sort(
      (a,b)=> new Date(a[0]) - new Date(b[0])
    );

    let holdings = 0;
    let totalSui = 0;
    let totalCost = 0;
    const computed = [];

    chronological.forEach(([dateStr, suiAmount, acqCost])=>{
      const avgCost = suiAmount > 0 ? acqCost / suiAmount : 0;
      holdings  += suiAmount;
      totalSui  += suiAmount;
      totalCost += acqCost;
      computed.push({ date:dateStr, suiAmount, acqCost, avgCost, holdings });
    });

    const weightedAvg = totalSui > 0 ? totalCost / totalSui : 0;

    // purchases table rows (latest first)
    const rows = computed.slice().reverse();

    const summaryRowHtml = `
      <tr class="summary-row">
        <td>—</td>
        <td>Total purchases</td>
        <td class="num">${nf2.format(totalSui)}</td>
        <td class="num">£${nf2.format(weightedAvg)}</td>
        <td class="num">£${nf2.format(totalCost)}</td>
        <td class="num">${nf0.format(holdings)}</td>
      </tr>
    `;

    const detailRowsHtml = rows.map((r,i)=>{
      const count = rows.length - i;
      const reported = new Date(r.date).toLocaleDateString("en-GB",{dateStyle:"medium"});
      return `<tr>
        <td>${count}</td>
        <td>${reported}</td>
        <td class="num">${nf2.format(r.suiAmount)}</td>
        <td class="num">£${nf2.format(r.avgCost)}</td>
        <td class="num">£${nf2.format(r.acqCost)}</td>
        <td class="num">${nf0.format(r.holdings)}</td>
      </tr>`;
    }).join("");

    purchasesBody.innerHTML = summaryRowHtml + detailRowsHtml;

    // ---------- SALES LEDGER ----------
    const salesChrono = SALES.slice().sort(
      (a,b)=> new Date(a[0]) - new Date(b[0])
    );
    const salesRows = salesChrono.slice().reverse();
    const totalSoldSui = salesChrono.reduce((sum,[,sui])=> sum + sui, 0);
    const totalProceeds = salesChrono.reduce((sum,[,,gbp])=> sum + gbp, 0);

    const salesDetailHtml = salesRows.map((s,i)=>{
      const [dateStr, suiSold, gbp] = s;
      const count = salesRows.length - i;
      const reported = new Date(dateStr).toLocaleDateString("en-GB",{dateStyle:"medium"});
      return `<tr>
        <td>${count}</td>
        <td>${reported}</td>
        <td class="num">${nf2.format(suiSold)}</td>
        <td class="num">£${nf2.format(gbp)}</td>
      </tr>`;
    }).join("");

    const salesSummaryHtml = `
      <tr class="summary-row">
        <td>—</td>
        <td>Total sales</td>
        <td class="num">${nf2.format(totalSoldSui)}</td>
        <td class="num">£${nf2.format(totalProceeds)}</td>
      </tr>
    `;

    salesBody.innerHTML = salesSummaryHtml + salesDetailHtml;

    // ---------- TOP SUMMARY PANEL ----------
    const netHoldings = totalSui - totalSoldSui;  // should be 8,674.96
    const currentCostPool = weightedAvg * netHoldings; // Section 104 style, same avg

    summaryBox.innerHTML = `
      <span><strong>Total SUI purchased:</strong> ${nf2.format(totalSui)}</span>
      <span><strong>Total SUI sold:</strong> ${nf2.format(totalSoldSui)}</span>
      <span><strong>Current SUI holdings:</strong> ${nf2.format(netHoldings)}</span>
      <span><strong>Weighted avg cost / SUI:</strong> £${nf2.format(weightedAvg)}</span>
      <span><strong>Cost pool (current):</strong> £${nf2.format(currentCostPool)}</span>
    `;

  })();
  </script>

  <div id="site-footer"></div>
  <script>
    fetch('/kah1/footer.html')
      .then(r => r.text())
      .then(html => { document.getElementById('site-footer').innerHTML = html; })
      .catch(console.error);
  </script>
</body>
</html>
